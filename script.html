<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Romeo & Juliet: Interactive Story</title>
  <style>
    body {
      font-family: Georgia, serif;
      background-color: #fbeee0;
      color: #333;
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      color: #a12c2f;
    }
    .story, .choices {
      margin-top: 20px;
    }
    .choice-btn {
      display: inline-block;
      margin: 10px 10px 0 0;
      padding: 10px 20px;
      background-color: #a12c2f;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    .choice-btn.show {
      opacity: 1;
      pointer-events: auto;
    }
    .typewriter {
      border-right: .15em solid #a12c2f;
      white-space: pre-wrap;
      overflow: hidden;
    }
    #minigame, #battle {
      margin-top: 30px;
      display: none;
    }
    #gameCanvas {
      background: #f4e2d8;
      border: 2px solid #a12c2f;
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>

  <h1>Romeo & Juliet: The Interactive Story</h1>

  <div id="game">
    <div id="story" class="story typewriter"></div>
    <div id="choices" class="choices"></div>
  </div>

  <div id="minigame">
    <canvas id="gameCanvas" width="600" height="150"></canvas>
    <p style="text-align: center;">Press Space to jump! üßë‚Äçü¶± is running from üó°Ô∏è</p>
  </div>

  <div id="battle">
    <h2>‚öîÔ∏è Duel Begins!</h2>
    <p>You draw your sword and face Tybalt!</p>
    <button onclick="endBattle()">Strike!</button>
  </div>

  <script>
    const scenes = {
      start: {
        text: "You are Romeo of House Montague.\n\nYour friend Benvolio tells you the Capulets are throwing a masquerade ball tonight. Do you go?",
        choices: [
          { text: "Crash the party", next: "party" },
          { text: "Stay home", next: "home" }
        ]
      },
      home: {
        text: "You stay home, avoiding trouble. You never meet Juliet.\n\nYour life continues... safely but without love.\n\nThe story ends before it begins. üíî",
        choices: [{ text: "Restart", next: "start" }]
      },
      party: {
        text: "You sneak into the Capulet ball.\n\nMasked and mysterious, you dance. Your eyes meet Juliet's across the room. Time stops.\n\nBut Tybalt recognizes your voice.",
        choices: [
          { text: "Talk to Juliet", next: "balcony" },
          { text: "Confront Tybalt", next: "runMiniGame" }
        ]
      },
      balcony: {
        text: "You meet Juliet at her balcony later that night.\n\nShe confesses her love. You swear to marry in secret tomorrow.\n\nThe next day, news spreads: Tybalt wants revenge.",
        choices: [
          { text: "Duel Tybalt to protect honor", next: "banishment" },
          { text: "Avoid the fight", next: "peace" }
        ]
      },
      duel: {
        text: "Tybalt challenges you at the party.\n\nYou draw your sword. After a fierce battle, you defeat him‚Äîbut the Prince banishes you for bloodshed.",
        choices: [{ text: "Continue", next: "banishment" }]
      },
      peace: {
        text: "You try to avoid Tybalt. But Mercutio fights in your place and dies.\n\nFueled by grief, you slay Tybalt anyway.\n\nThe Prince arrives: you're banished.",
        choices: [{ text: "Continue", next: "banishment" }]
      },
      banishment: {
        text: "You and Juliet secretly marry. But you're sent away from Verona.\n\nJuliet fakes her death to avoid marrying Paris.\n\nYou hear of her 'death' and rush back, heartbroken.",
        choices: [
          { text: "Take poison beside Juliet", next: "tragedy" },
          { text: "Wait and investigate", next: "survive" }
        ]
      },
      tragedy: {
        text: "You take the poison and die beside Juliet.\n\nMoments later, she awakens. Finding you dead, she ends her life too.\n\nTheir love unites the feuding families at last... but at a terrible cost.",
        choices: [{ text: "Play again", next: "start" }]
      },
      survive: {
        text: "You pause. Something feels wrong.\n\nYou discover Juliet is alive and learn of her plan just in time.\n\nYou escape together to Mantua, far from hate, free at last.",
        choices: [{ text: "Play again", next: "start" }]
      }
    };

    const storyEl = document.getElementById('story');
    const choicesEl = document.getElementById('choices');
    const minigame = document.getElementById('minigame');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const battle = document.getElementById('battle');

    function typeWriter(text, callback) {
      storyEl.innerHTML = '';
      let i = 0;
      const speed = 30;
      function type() {
        if (i < text.length) {
          storyEl.innerHTML += text.charAt(i);
          i++;
          setTimeout(type, text.charAt(i - 1) === '\n' ? speed * 2 : speed);
        } else {
          callback();
        }
      }
      type();
    }

    function showScene(sceneId) {
      if (sceneId === "runMiniGame") {
        startMiniGame();
        return;
      }
      minigame.style.display = 'none';
      battle.style.display = 'none';
      canvas.width = canvas.width; // Clear canvas
      const scene = scenes[sceneId];
      typeWriter(scene.text, () => {
        choicesEl.innerHTML = '';
        scene.choices.forEach((choice, index) => {
          const btn = document.createElement('a');
          btn.className = 'choice-btn';
          btn.textContent = choice.text;
          btn.onclick = () => {
            const allBtns = document.querySelectorAll('.choice-btn');
            allBtns.forEach(b => {
              b.classList.remove("show");
              b.style.pointerEvents = "none";
            });
            showScene(choice.next);
          };
          choicesEl.appendChild(btn);
          setTimeout(() => btn.classList.add('show'), 300 * index);
        });
      });
    }

    // Start the game
    showScene('start');

    // --- Mini Game Logic ---
    let romeoY = 100;
    let velocityY = 0;
    let isJumping = false;
    const gravity = 1;
    let hurdles = [];
    let hurdleTimer = 0;
    let startTime = null;
    let gameOver = false;

    function startMiniGame() {
      storyEl.innerHTML = '';
      choicesEl.innerHTML = '';
      minigame.style.display = 'block';
      hurdles = [];
      romeoY = 100;
      velocityY = 0;
      isJumping = false;
      gameOver = false;
      startTime = performance.now();
      requestAnimationFrame(runMiniGame);
    }

    function runMiniGame(timestamp) {
      let elapsed = (timestamp - startTime) / 1000;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Romeo (üßë‚Äçü¶±)
      ctx.font = '30px serif';
      ctx.fillText('üßë‚Äçü¶±', 50, romeoY);

      // Tybalt (üó°Ô∏è)
      ctx.fillText('üó°Ô∏è', 10, 100);

      // Hurdles
      hurdleTimer++;
      if (hurdleTimer > 100) {
        hurdles.push({ x: 600 });
        hurdleTimer = 0;
      }

      for (let i = hurdles.length - 1; i >= 0; i--) {
        hurdles[i].x -= 5;
        ctx.fillText('‚¨õ', hurdles[i].x, 100);
        if (
          hurdles[i].x < 75 &&
          hurdles[i].x > 25 &&
          romeoY > 70
        ) {
          gameOver = true;
        }
      }

      // Jumping logic
      if (isJumping) {
        velocityY -= gravity;
        romeoY -= velocityY;
        if (romeoY >= 100) {
          romeoY = 100;
          velocityY = 0;
          isJumping = false;
        }
      }

      if (gameOver) {
        ctx.fillStyle = 'red';
        ctx.font = '20px sans-serif';
        ctx.fillText('Game Over! Tybalt caught you!', 200, 80);
        setTimeout(() => showScene("duel"), 2000);
        return;
      }

      if (elapsed >= 20) {
        minigame.style.display = 'none';
        battle.style.display = 'block';
        return;
      }

      requestAnimationFrame(runMiniGame);
    }

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && !isJumping && minigame.style.display === 'block') {
        isJumping = true;
        velocityY = 15;
      }
    });

    function endBattle() {
      showScene("duel");
    }
  </script>

</body>
</html>
